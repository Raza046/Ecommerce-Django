
{% load static %}

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Boxicons -->
	<link href="https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css" rel="stylesheet">
	<!-- My CSS -->
	<link rel="stylesheet" href="{% static 'css/admin_style.css' %}">

	<link
	rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
  />
  <!-- Google Fonts Roboto -->
  <link
	rel="stylesheet"
	href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap"
  />


  <!-- MDB -->
  <link rel="stylesheet" href="{% static 'css/mdb.min.css' %}" />
	<!--  Above line of code will blast the admin sidebar -->

</head>

<style>

body {
        animation: fadeIn ease 3s;
        animation-iteration-count: 1;
        animation-fill-mode: forwards;
    }
@keyframes fadeIn {
  from {
    opacity: 0;
    /* transform: translateX(-300px); */
  }
  to {
    opacity: 1;
    /* transform: translateX(0px); */
  }
}



* {
  box-sizing: border-box;
}

.item {
  padding: 20px 30px;
  height: 120px;
  display: flex;
}
 
.item:nth-child(3) {
  border-top:  1px solid #E1E8EE;
  border-bottom:  1px solid #E1E8EE;
}

.image {
  margin-right: 30px;
}
 
.description {
  padding-top: 10px;
  margin-right: 15px;
  width: 115px;
}
 
.description span {
  display: block;
  font-size: 14px;
  color: #43484D;
  font-weight: 400;
}
 
.description span:first-child {
  margin-bottom: 5px;
}
.description span:last-child {
  font-weight: 300;
  margin-top: 8px;
  color: #86939E;
}
 
button:focus,
input:focus {
  outline:0;
}

.total-price {
  width: 83px;
  padding-top: 27px;
  text-align: center;
  font-size: 16px;
  color: #43484D;
  font-weight: 300;
}

.box {
  width: 20px;
  height: 20px;
  /* border: 1px solid rgba(0, 0, 0, .1); */
  border-radius: 5px;
  margin-top: 1vw;
}

.form button {
  width: 100%;
  outline: none !important;
  background: linear-gradient(90deg, #11998e, #38ef7d);
  text-transform: uppercase;
  font-weight: bold;
  border: none;
  box-shadow: none;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
  margin-top: 90px;
}

#customer-form{
margin-top:0vw;
}

/*  */
</style>

<body>

    <form action="ViewPaymentPage" id="customer-form" class="js-customer-form" method="post">
        {% csrf_token %}

        <div id="wrapper-site">
                <div class="">
                    <div class="row">
                        <div id="content-wrapper" class="col-xs-12 col-sm-12 col-md-12 col-lg-12 onecol">
                            <div id="main">
                                <div class="cart-grid row">

                                    <div class="col-md-7 check-info" style="border-right: 0.1px solid #e7e7e7;padding:100px">
                                        <div class="checkout-personal-step">
                                          <center><img src="{% static 'ecom_logo.png' %}" height="150px" style="margin-top:-30px" alt=""></center>
                                          <nav aria-label="breadcrumb" style="margin-left:13vw;">
                                            <ol class="breadcrumb">
                                              <li class="breadcrumb-item">Cart</li>
                                              <li class="breadcrumb-item"><b>Information</b></li>
                                              <li class="breadcrumb-item">Payment</li>
                                            </ol>
                                          </nav><br>

                                          <h5 style="font-family:bold;" class="step-title info">
                                                Contact Information
                                            </h5>
                                        </div>
                                        <div class="content">
                                            <div class="tab-content">
                                                <div class="tab-pane fade in active show" id="checkout-guest-form" role="tabpanel">
                                                            <input type="hidden" name="id_customer" value="">

                                                            <div class="form-outline mb-4">
                                                              {{ form.email }}
                                                              <label class="form-label" >Email</label>
                                                          </div>
                                                          <div class="form-check">
                                                            <input class="form-check-input" type="checkbox" value="" id="checkoutForm0" />
                                                            <label class="form-check-label" for="checkoutForm0">
                                                                Sign up for our newsletter
                                                            </label>
                                                          </div><br>

                                                          <h5 style="font-family:bold;" class="step-title info">
                                                            Shipping address
                                                          </h5>

                                                          <div class="row mb-4">
                                                            <div class="col">
                                                              <div class="form-outline">
                                                                {{ form.first_name }}
                                                                <label class="form-label">First Name</label>
                                                              </div>
                                                            </div>
                                                            <div class="col">
                                                              <div class="form-outline">
                                                                {{ form.last_name }}
                                                                <label class="form-label">Last name</label>
                                                              </div>
                                                            </div>
                                                          </div>

                                                          <div class="form-outline mb-4">
                                                             {{ form.address }}
                                                              <label class="form-label" >Address</label>
                                                          </div>

                                                        <div class="row mb-4">
                                                          <div class="col">
                                                            <div class="form-outline">
                                                              {{ form.country }}
                                                              <label class="form-label" >Country</label>
                                                            </div>
                                                          </div>

                                                            <div class="col">
                                                              <div class="form-outline">
                                                                {{ form.city }}
                                                                <label class="form-label" >City</label>
                                                            </div>
                                                          </div>
                                                        </div>

                                                            <div class="form-outline mb-4">
                                                              {{ form.contact }}
                                                                <label class="form-label" >Contact</label>
                                                            </div>

                                                            <!-- <br> -->
                                                            <!-- <hr class="my-4" /> -->

                                                            <div class="form-check">
                                                            <input class="form-check-input" type="checkbox" value="" id="checkoutForm1" />
                                                            <label class="form-check-label" for="checkoutForm1">
                                                                Shipping address is the same as my billing address
                                                            </label>
                                                            </div>

                                                            <div class="form-check mb-4">
                                                            <input class="form-check-input" type="checkbox" value="" id="checkoutForm2" checked />
                                                            <label class="form-check-label" for="checkoutForm2">
                                                                Save this information for next time
                                                            </label>
                                                            </div>
                                                      <hr class="my-4" />
                                                      <span style="color:maroon;display:none;" id="form_error"><b>Please complete all information</b></span>

                                                      <div class="row">
                                                            <div class="col-md-4"><br>
                                                            <h6><a href="/cart/view" style="color:rgb(56, 56, 56);"><i class="fas fa-long-arrow-alt-left ms-2"></i> Return to Cart  <img src="{% static 'shopping-cart.png' %}" style="height:30px"></a></h6><br>
                                                            </div>
                                                            <div class="col-md-4 offset-4">
                                                              <button id="continue_ship" type="button" onclick="ContinueShip()" class="btn btn-block" style="background-color:#192552;color:white;padding:20px;margin-left:2vw;text-transform:capitalize;font-size:medium;">Continue</button>
                                                            </div>
                                                          </div>
                                                  </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-5" style="align-items:center;background-color:#fafafa;width:40%;padding:20px">
                                        {% if cart %}

                                        <div class="col-md-12 col-xl-12" style="margin-top:15px;">

                                            <div class="rounded d-flex flex-column p-2 ">

                                              {% for c in cart %}

                                              <div class="item">
                                                
                                                <div class="description" style="margin-top:-20px">
                                                    <img style="max-width:65%;border-radius:12px;" class="shadow-3-strong"  src="{{c.product_variant.images.Image}}" alt="{{c.product_variant.Size_variants.Product.Name}}" />
                                                </div>

                                                <div class="description" style="margin-top:-1vw;margin-left:-3vw;">
                                                    <div class="box" style="margin-left:-2vw;margin-top:-1.5vw;background-color:#f3173c;border-radius:50%;">
                                                        <center><span style="color:white !important;"><b>{{c.quantity}}</b></span></center>
                                                    </div>
                                                        <span style="margin-top:-0.7vw">{{c.product_variant.product.Name|capfirst|truncatechars:12}}</span>
                                                    {% for s in c.product_variant.variation.all %}
                                                        {% if s.variation.name == "Size" %}
                                                            <span>{{s.value}}</span>
                                                        {% endif %}
                                                    {% endfor %}
                                                    <div class="box shadow-3-strong" style="background:{{c.product_variant.color}};margin-top:0vw"></div>
                                                </div>
                                                <div id="price_{{c.id}}" style="margin-top:-2vw;padding-left:10vw;" class="total-price"><b>${{c.price}}</b></div>
                                                </div>

                                              {% endfor %}

                                              <br>
                                              <div class="border-top px-2 mx-2"></div>
                                              <div class="p-2 d-flex">
                                                <div class="col-8" id="disc_perc">
                                                  Discount (0%)
                                                </div>
                                                <div class="ms-auto" style="color:#3c91e6"><span id="disc_val"><b>$0</b></span></div>
                                              </div>
                                              <div class="border-top px-2 mx-2"></div>
                                              <div class="p-2 d-flex pt-3">
                                                <div class="col-8">Subtotal</div>
                                                <div class="ms-auto"><span id="sub_total"><b>${{total_price}}</b></span></div>
                                              </div>
                                              <div class="p-2 d-flex">
                                                <div class="col-8">
                                                  Shipping Fee
                                                </div>
                                                <div class="ms-auto"><b>Free</b></div>
                                              </div>
                                              <div class="border-top px-2 mx-2"></div>
                                              <div class="p-2 d-flex pt-3">
                                                <div class="col-8"><b>Total</b></div>
                                                <div class="ms-auto" ><b class="text-success">$<span id="total_price">{{total_price}}</span></b></div>
                                              </div>
                                            </div>
                                          </div>

                                        {% endif %}


                                          <!-- Material input -->
                                            <div style="padding:20px">
                                              <div class="form-outline mb-4 shadow-3-strong">
                                              <input type="text" id="coupon_form" name="coupon_forms" class="form-control" />
                                                  <label class="form-label" id="coupon_form_label">Coupon Code</label>
                                              </div>

                                              <!-- <input type="text" id="coupon_form" name="coupon_forms" class="form-control" /> -->
                                              <button type="button" onclick="CouponApply('{{request.user.id}}')" id="applyBtn" class="btn btn-danger">Apply</button>
                                              <span id="Error_Coupon" style="visibility:hidden;">Invalid Coupon</span>
                                              <a href="javascript:void(0)" onclick="RemoveCoupon('{{request.user.id}}')" id="remove_coupon" style="display:none;color:#f93154;">Remove Coupon</a>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            <br>

        </form>

</body>

{% block extrascripts %}

<!-- Material Design for Bootstrap -->
<script src="{% static 'js/mdb.min.js' %}"></script>


<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

<script>

$(document).ready(function() {

    {% if coupon_used %}
      c_code = '{{coupon_used.code}}';
      discount = {{coupon_used.discount}}/100;
      discount_perc = {{coupon_used.discount}};
      console.log('-------------')
      console.log(discount)
      console.log(discount_perc)
      console.log('-------------')
      document.getElementById('coupon_form_label').style.visibility='hidden';
      ApplyDiscount(discount, discount_perc, c_code);
    {% endif %}

   });

   function ApplyDiscount(discount, discount_perc, c_code){

    var total_price = document.getElementById("total_price").innerText;

    console.log("Value of discount : " + discount);
    total_disc_price = discount * total_price;
    total_price = total_price - total_disc_price;
    document.getElementById("total_price").innerText = total_price;
    document.getElementById("sub_total").innerHTML = "<b>$" + total_price +"</b>";
    console.log(total_price);
    document.getElementById("applyBtn").disabled = true;
    mybtn.className = "btn btn-success"
    mybtn.innerText = "Coupon Applied!"
    document.getElementById("coupon_form").disabled = true;
    document.getElementById("coupon_form").value = c_code;
    rem_mybtn.style.display = "block";

    document.getElementById("disc_perc").innerText = "Discount (" + discount_perc + "%)";
    document.getElementById("disc_val").innerHTML = "<b>$" + total_disc_price + "</b>";
}


function ContinueShip() {
  email = document.getElementById("email_form").checkValidity()
  fname = document.getElementById("fname_form").checkValidity()
  lname = document.getElementById("lastname_form").checkValidity()
  address = document.getElementById("address_form").checkValidity()
  country = document.getElementById("country_form").checkValidity()
  city = document.getElementById("city_form").checkValidity()
  contact = document.getElementById("contact_form").checkValidity()


  if(email && fname && lname && address && country && city && contact){
    $('#continue_ship').html('Redirecting... <span class="spinner-border spinner-border-sm mr-2" role="status"></span>').attr('disabled', true);

        setTimeout(function(){
          $('#customer-form').submit()
          $('#continue_ship').html('<b>Continue</b>').attr('disabled', false);
        },2000)
      }
      else{
        document.getElementById('form_error').style.display = "block";
      }
  }

$(document).ready(function () {
  $('.radio-group .radio').click(function () {
      $('.selected .fa').removeClass('fa-check');
      $('.radio').removeClass('selected');
      $(this).addClass('selected');
  });
});


var mybtn = document.getElementById("applyBtn")
var rem_mybtn = document.getElementById("remove_coupon")
var total_prices = document.getElementById("total_price").innerText;

function RemoveCoupon(user_id){

    var code = document.getElementById("coupon_form").value;
    var total_price = document.getElementById("total_price").innerText;
    var discount = 0;
    console.log(code)

    $.ajax({
            'async': false,
            url: '/coupon/remove',
            data : {
                'coupon_code': code,
            },
            success: (data) => {
                console.log(data);
                // discount = data;
            },
    });


    mybtn.disabled = false;
    mybtn.className = "btn btn-danger"
    mybtn.innerText = "Apply"
    document.getElementById("coupon_form").disabled = false;
    rem_mybtn.style.display = "none";
    document.getElementById("coupon_form").value = "";
    document.getElementById("total_price").innerText = total_prices;
    document.getElementById("sub_total").innerHTML = "<b>$" + total_prices +"</b>";

    document.getElementById("disc_perc").innerText = "Discount (0%)";
    document.getElementById("disc_val").innerHTML = "<b>$0</b>";

}


function CouponApply(user_id){

    var code = document.getElementById("coupon_form").value;
    var total_price = document.getElementById("total_price").innerText;
    var response = "";
    console.log(user_id);
    console.log(code)

    $.ajax({
            'async': false,
            url: '/coupon/apply',
            data : {
                'user_id': user_id,
                'coupon_code': code,
            },
            success: (data) => {
              response = data;
            },
    });

    if(response.status == "Successfull!"){

        discount_perc = response.discount;

        discount = discount_perc/100;
        console.log("Value of discount : " + discount);
        total_disc_price = discount * total_price;
        total_price = total_price - total_disc_price;
        document.getElementById("total_price").innerText = total_price;
        document.getElementById("sub_total").innerHTML = "<b>$" + total_price +"</b>";
        console.log(total_price);
        document.getElementById("applyBtn").disabled = true;
        mybtn.className = "btn btn-success"
        mybtn.innerText = "Coupon Applied!"
        document.getElementById("coupon_form").disabled = true;
        rem_mybtn.style.display = "block";

        document.getElementById("disc_perc").innerText = "Discount (" + discount_perc + "%)";
        document.getElementById("disc_val").innerHTML = "<b>$" + total_disc_price + "</b>";
    }
    else{
        console.log("Invalid or Expired Coupon")
    }

}

</script>
<!-- <script src="{% static 'js/themes.js' %}"></script> -->


{% endblock %}

