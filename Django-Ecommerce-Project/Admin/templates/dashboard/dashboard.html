{% extends "dashboard/dashboard_base.html" %}
{% load static %}

{% block content %}

<style>

</style>


<body>
	  
	  <!--Main layout-->
	  <main style="margin-top:85px">
		<div class="container pt-4">
			<h2 style="font-family:bold">Welcome Back, {{request.user.username|capfirst}}</h2>
			<h6 style="color:grey;font-family:bold">Here's what's happening with your store today.</h6><br>

			<section>
				<div class="row">
					<div class="col-xl-3 col-sm-6 col-12 mb-4">
					  <div class="card">
						<div class="card-body">
						  <div class="d-flex justify-content-between px-md-1">
							<div>
							  <h3 class="text-info" id="earnings_id">{{total_earnings.total__sum}}</h3>
							  <p class="mb-0">Total Earnings</p>
							</div>
							<div class="align-self-center">
							  <i class="fas fa-book-open text-info fa-3x"></i>
							</div>
						  </div>
						  <div class="px-md-1">
							<div class="progress mt-3 mb-1 rounded" style="height: 7px">
							  <div
								   class="progress-bar bg-info"
								   role="progressbar"
								   style="width: 80%"
								   aria-valuenow="80"
								   aria-valuemin="0"
								   aria-valuemax="100"
								   ></div>
							</div>
						  </div>
						</div>
					  </div>
					</div>
					<div class="col-xl-3 col-sm-6 col-12 mb-4">
					  <div class="card">
						<div class="card-body">
						  <div class="d-flex justify-content-between px-md-1">
							<div>
							  <h3 id="sales_id" class="text-warning">{{sales.count}}</h3>
							  <p class="mb-0">Total Sales</p>
							</div>
							<div class="align-self-center">
							  <i class="far fa-comments text-warning fa-3x"></i>
							</div>
						  </div>
						  <div class="px-md-1">
							<div class="progress mt-3 mb-1 rounded" style="height: 7px">
							  <div
								   class="progress-bar bg-warning"
								   role="progressbar"
								   style="width: 35%"
								   aria-valuenow="35"
								   aria-valuemin="0"
								   aria-valuemax="100"
								   ></div>
							</div>
						  </div>
						</div>
					  </div>
					</div>
					<div class="col-xl-3 col-sm-6 col-12 mb-4">
					  <div class="card">
						<div class="card-body">
						  <div class="d-flex justify-content-between px-md-1">
							<div>
							  <h3 class="text-success">64</h3>
							  <p class="mb-0">Visitors</p>
							</div>
							<div class="align-self-center">
							  <i class="fas fa-mug-hot text-success fa-3x"></i>
							</div>
						  </div>
						  <div class="px-md-1">
							<div class="progress mt-3 mb-1 rounded" style="height: 7px">
							  <div
								   class="progress-bar bg-success"
								   role="progressbar"
								   style="width: 60%"
								   aria-valuenow="60"
								   aria-valuemin="0"
								   aria-valuemax="100"
								   ></div>
							</div>
						  </div>
						</div>
					  </div>
					</div>
					<div class="col-xl-3 col-sm-6 col-12 mb-4">
					  <div class="card">
						<div class="card-body">
						  <div class="d-flex justify-content-between px-md-1">
							<div>
							  <h3 class="text-danger">{{p_count}}</h3>
							  <p class="mb-0">Total Products</p>
							</div>
							<div class="align-self-center">
							  <i class="fas fa-map-signs text-danger fa-3x"></i>
							</div>
						  </div>
						  <div class="px-md-1">
							<div class="progress mt-3 mb-1 rounded" style="height: 7px">
							  <div
								   class="progress-bar bg-danger"
								   role="progressbar"
								   style="width: 40%"
								   aria-valuenow="40"
								   aria-valuemin="0"
								   aria-valuemax="100"
								   ></div>
							</div>
						  </div>
						</div>
					  </div>
					</div>
				  </div>
	  
			  </section> <br>
			  <!--Section: Minimal statistics cards-->
		  
	<center>
		<button class="btn btn" onclick="ChangeGraph('bar')"><img src="https://cdn-icons-png.flaticon.com/128/1011/1011528.png" height="30px" alt=""> Bar View</button>
		<button class="btn btn" onclick="ChangeGraph('pie')"><img src="https://cdn-icons-png.flaticon.com/128/2257/2257295.png" height="30px" alt=""> Pie-Chart View</button>
		<button class="btn btn" onclick="ChangeGraph('doughnut')"><img src="https://cdn-icons-png.flaticon.com/128/3176/3176353.png" height="30px" alt=""> Doughnut View</button>
		<button class="btn btn" onclick="ChangeGraph('line')"><img src="https://cdn-icons-png.flaticon.com/128/1807/1807350.png" height="30px" alt=""> Line View</button>
		<button class="btn btn" onclick="ChangeGraph('polarArea')"><img src="https://cdn-icons-png.flaticon.com/128/7849/7849272.png" height="30px" alt=""> Polar Area View</button>
		<button class="btn btn" onclick="ChangeGraph('radar')"><img src="https://cdn-icons-png.flaticon.com/128/6754/6754760.png" height="30px" alt=""> Radar View</button>
	</center><br><br>

	<div class="row">

		<div class="col-md-1">
			<label class="form-label">From</label>
		</div>

		<div class="col-md-2">
			<div class="form-outline">
			<input type="date" id="from" class="form-control" value="2022-10-06" />
			</div>
		</div>
	
		<div class="col-md-1">
			<label class="form-label">To</label>
		</div>

		<div class="col-md-2">
			<div class="form-outline">
			<input type="date" id="to" class="form-control" value="2022-10-06" />
			</div>
		</div>

		<div class="col-md-2 offset-4">
			<button onclick="FilterGraph()" type="submit" class="btn btn-primary">Submit</button>
		</div>

	</div>


	<!-- Section: Main chart -->
		  <section class="mb-4"><br>
			<canvas id="bar-chart" height="15vh" width="60vw"></canvas>
		</section>
		  <!-- Section: Main chart -->
	  
		  <!--Section: Sales Performance KPIs-->
		  <section class="mb-4">
			<div class="card">
			  <div class="card-header text-center py-3">
				<h5 class="mb-0 text-center">
				  <strong>Top Products</strong>
				</h5>
			  </div>
			  <div class="card-body">
				<div class="table-responsive">
				  <table class="table table-hover text-nowrap">
					<thead>
					  <tr>
						<th scope="col">Image</th>
						<th scope="col">Product</th>
						<th scope="col">Total Purchases</th>
						<th scope="col">Product Revenue</th>
						<th scope="col">Avg. Price</th>
					  </tr>
					</thead>
					<tbody>
						{% for p_key,p_value in top_poducts.items %}
					  <tr>
						<th scope="row"><img src="{{p_key.images.Image}}" height="60px" alt=""></th>
						<td>{{p_key.product.Name| truncatechars:21}}</td>
						<td>{{p_value}}</td>
						<td>{% widthratio p_key.price 1 p_value %}</td>
						<td>$13.68</td>
					  </tr>
					  {% endfor %}
					</tbody>
				  </table>
				</div>
			  </div>
			</div>
		  </section>
		  <!--Section: Sales Performance KPIs-->
	  
		  <!--Section: Statistics with subtitles-->
		  <section>
			<div class="row">
			  <div class="col-xl-6 col-md-12 mb-4">
				<div class="card">
				  <div class="card-body">
					<div class="d-flex justify-content-between p-md-1">
					  <div class="d-flex flex-row">
						<div class="align-self-center">
						  <i class="fas fa-pencil-alt text-info fa-3x me-4"></i>
						</div>
						<div>
						  <h4>Total Product Sold</h4>
						  <p class="mb-0">Monthly Progress</p>
						</div>
					  </div>
					  <div class="align-self-center">
						<h2 class="h1 mb-0">{{prod_sold}}</h2>
					  </div>
					</div>
				  </div>
				</div>
			  </div>
			  <div class="col-xl-6 col-md-12 mb-4">
				<div class="card">
				  <div class="card-body">
					<div class="d-flex justify-content-between p-md-1">
					  <div class="d-flex flex-row">
						<div class="align-self-center">
						  <i
							 class="far fa-comment-alt text-warning fa-3x me-4"
							 ></i>
						</div>
						<div>
						  <h4>Total Reviews</h4>
						  <p class="mb-0">Monthly product reviews</p>
						</div>
					  </div>
					  <div class="align-self-center">
						<h2 class="h1 mb-0">{{reviews.count}}</h2>
					  </div>
					</div>
				  </div>
				</div>
			  </div>
			</div>
			<div class="row">
			  <div class="col-xl-6 col-md-12 mb-4">
				<div class="card">
				  <div class="card-body">
					<div class="d-flex justify-content-between p-md-1">
					  <div class="d-flex flex-row">
						<div class="align-self-center">
						  <h2 class="h1 mb-0 me-4">$76,456.00</h2>
						</div>
						<div>
						  <h4>Total Sales</h4>
						  <p class="mb-0">Monthly Sales Amount</p>
						</div>
					  </div>
					  <div class="align-self-center">
						<i class="far fa-heart text-danger fa-3x"></i>
					  </div>
					</div>
				  </div>
				</div>
			  </div>
			  <div class="col-xl-6 col-md-12 mb-4">
				<div class="card">
				  <div class="card-body">
					<div class="d-flex justify-content-between p-md-1">
					  <div class="d-flex flex-row">
						<div class="align-self-center">
						  <h2 class="h1 mb-0 me-4">$36,000.00</h2>
						</div>
						<div>
						  <h4>Total Cost</h4>
						  <p class="mb-0">Monthly Cost</p>
						</div>
					  </div>
					  <div class="align-self-center">
						<i class="fas fa-wallet text-success fa-3x"></i>
					  </div>
					</div>
				  </div>
				</div>
			  </div>
			</div>
		  </section>
		  <!--Section: Statistics with subtitles-->
		</div>
	  </main>
	  <!--Main layout-->

</body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
<script type="text/javascript">

let graph_type = 'bar'
months = []
m_data = []

{% for key, value in month_data.items %}
	months.push("{{key}}")
	m_data.push("{{value}}")
{% endfor %}

function MyGraph(val){

// Bar chart
const dataBar = {
  type: graph_type,
  data: {
    labels:months,
    datasets: [
      {
        label: 'Monthly Sales',
        data: m_data,
		backgroundColor: [
		'rgba(255, 99, 132, 0.5)',
		'rgba(255, 159, 64, 0.5)',
		'rgba(255, 205, 86, 0.5)',
		'rgba(75, 192, 192, 0.5)',
		'rgba(54, 162, 235, 0.5)',
		'rgba(153, 102, 255, 0.5)',
		'rgba(201, 203, 207, 0.5)',
		'rgba(155, 169, 205, 0.5)',
		'rgba(154, 162, 35, 0.5)',
		'rgba(153, 102, 255, 0.5)',
		'rgba(201, 203, 207, 0.5)',
		'rgba(155, 169, 205, 0.5)',
		]
	},
	],
  },
};
return dataBar;
}

myChart = new Chart(document.getElementById('bar-chart'), MyGraph('bar'));

function ChangeGraph(val){
  graph_type = val;
  myChart.destroy();
  myChart = new Chart(document.getElementById('bar-chart'), MyGraph(val));
}


function FilterGraph(p_id){

from = document.getElementById("from").value;
to = document.getElementById("to").value;

var formdata = new FormData();

formdata.append("from_date", from);
formdata.append("to_date", to);
formdata.append("csrfmiddlewaretoken", "{{ csrf_token }}");

$.ajax({
  method: "POST",
  url : "/filter_graph",
  processData: false,
  contentType: false,
  mimeType: "multipart/form-data",
  data : formdata,
  success: function(res) {
	  console.log(res);
	  val = JSON.parse(res);
	  FilterResponse(val);
  }
});

}


function FilterResponse(res){

	months = [];
	m_data = [];

	for (let k in res) {
		months.push(k);
		m_data.push(res[k]);
	}

	ChangeGraph('bar');
}


</script>


{% endblock %}
